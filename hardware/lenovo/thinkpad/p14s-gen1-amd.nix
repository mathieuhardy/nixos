{ lib, pkgs, ... }:

{
  # ----------------------------------------------------------------------------
  # Imports
  # ----------------------------------------------------------------------------

  imports = lib.optional (builtins.pathExists ./p14s-gen1-amd-readonly.nix) ./p14s-gen1-amd-readonly.nix;

  # ----------------------------------------------------------------------------
  # Bluetooth
  # ----------------------------------------------------------------------------

  hardware.bluetooth.enable = true;

  # ----------------------------------------------------------------------------
  # AMD
  # ----------------------------------------------------------------------------

  boot.initrd.kernelModules = [ "amdgpu" ];
  services.xserver.videoDrivers = [ "amdgpu" ];

  # ----------------------------------------------------------------------------
  # Kernel
  # ----------------------------------------------------------------------------

  #boot.kernelParams = [ "boot.shell_on_fail" ];
  boot.kernelPackages = pkgs.linuxPackages_latest;

  # ----------------------------------------------------------------------------
  # Configuration
  # ----------------------------------------------------------------------------

  settings.hardware.cpu.temperature = {
    device = "thinkpad";
    core_pattern = "^temp[0-9]+$";
  };
}
