# TODO: ESC pour cacher les fenêtres floating BT, ...
# TODO: waybar fixed workspaces => pas bon

# ────────────────────────────────────────────────────────────────────────────
# Global configuration
# ────────────────────────────────────────────────────────────────────────────

# No fucking animation
animations {
    enabled = false
}

# View
general {
    # Spacing
    gaps_in = 5
    gaps_out = 5

    # Border
    border_size = 2
    col.active_border = rgb(f39660)

    # Icon to resize the border
    resize_on_border = true
    hover_icon_on_border = true

    # Window snapping
    snap {
        # Snapping for floating windows
        enabled = true
        respect_gaps = true
    }
}

decoration {
    rounding = 2

    shadow {
        enabled = false
    }
}

# ────────────────────────────────────────────────────────────────────────────
# Monitors
# ────────────────────────────────────────────────────────────────────────────

# Disable ghost monitor
monitor = WAYLAND-1, disable

# TODO: set back laptop monitor
monitor = eDP-1, disable

# Global configuration
monitor=,preferred,auto,1

# ────────────────────────────────────────────────────────────────────────────
# Inputs
# ────────────────────────────────────────────────────────────────────────────

input {
    # Azerty keyboard configuration
    kb_layout = fr
    kb_variant = azerty

    # Numlock enabled at boot
    numlock_by_default = true

    # The focus doesn't follow the mouse automatically
    follow_mouse = 2

    # TODO: https://wiki.hypr.land/Configuring/Variables/#touchpad
}

# ────────────────────────────────────────────────────────────────────────────
# Startup
# ────────────────────────────────────────────────────────────────────────────

# Adaptative monitor setup (dispatch workspaces)
exec-once = ~/.config/hypr/scripts/monitor-setup.sh

# Top bar
exec-once = waybar -c ~/.config/waybar/config.json

# Background
exec-once = swaybg -m fill -i ~/.config/swaybg/wallpaper.jpg

# Locking automatic
exec-once = hypridle

# OSD
exec-once = swayosd-server

# Application launcher
exec-once = walker --gapplication-service

# ────────────────────────────────────────────────────────────────────────────
# Bindings
# ────────────────────────────────────────────────────────────────────────────

$mod = SUPER

# Open terminal
bind = $mod, T, exec, wezterm
bind = $mod, Enter, exec, wezterm

# Exit Wayland
bind = CTRL ALT, Delete, exit

# Current window (close, toggle floating, fullscreen)
bind = ALT, F4, killactive
bind = ALT, Return, fullscreen

bind = $mod, F, exec, hyprctl dispatch togglefloating && sleep 0.05 && hyprctl dispatch resizeactive exact 50% 50% && hyprctl dispatch centerwindow

# Screenshot
bind = , Print, exec, hyprshot -o ~/Pictures/Screenshots/ -m output
bind = ALT, Print, exec, hyprshot -o ~/Pictures/Screenshots/ -m window
bind = CTRL, Print, exec, hyprshot -o ~/Pictures/Screenshots/ -m region

# File manager
bind = $mod, E, exec, thunar

# Neovim
bind = $mod, N, exec, wezterm start -- nvim

# Calculator
bind = $mod, C, exec, qalculate-qt

# App launcher
bind = $mod, P, exec, walker

# Window switcher
bind = ALT, Tab, cyclenext
bind = ALT SHIFT, Tab, cyclenext, prev

# Window interactions
bindm = ALT, mouse:272, movewindow

# Power menu
bind = $mod, Escape, exec, nwg-bar
bind = ALT, Escape, exec, nwg-bar

# List of workspaces
workspace = 1, monitor:DP-2, default:true
workspace = 2, monitor:DP-2
workspace = 3, monitor:DP-2
workspace = 4, monitor:DP-2
workspace = 5, monitor:DP-2
workspace = 6, monitor:DP-2
workspace = 7, monitor:DP-2
workspace = 8, monitor:DP-2
workspace = 9, monitor:DP-2
workspace = 10, monitor:DP-2

# Cycle through workspaces
bind = $mod, Right, exec, ~/.config/hypr/scripts/workspace-navigation.sh 10 next
bind = $mod, Left, exec, ~/.config/hypr/scripts/workspace-navigation.sh 10 prev

# Jump to workspace
bind = $mod, KP_End, workspace, 1
bind = $mod, KP_Down, workspace, 2
bind = $mod, KP_Next, workspace, 3
bind = $mod, KP_Left, workspace, 4
bind = $mod, KP_Begin, workspace, 5
bind = $mod, KP_Right, workspace, 6
bind = $mod, KP_Home, workspace, 7
bind = $mod, KP_Up, workspace, 8
bind = $mod, KP_Prior, workspace, 9
bind = $mod, KP_Insert, workspace, 10

# Move current window to workspace
bind = $mod ALT, KP_End, movetoworkspacesilent, 1
bind = $mod ALT, KP_Down, movetoworkspacesilent, 2
bind = $mod ALT, KP_Next, movetoworkspacesilent, 3
bind = $mod ALT, KP_Left, movetoworkspacesilent, 4
bind = $mod ALT, KP_Begin, movetoworkspacesilent, 5
bind = $mod ALT, KP_Right, movetoworkspacesilent, 6
bind = $mod ALT, KP_Home, movetoworkspacesilent, 7
bind = $mod ALT, KP_Up, movetoworkspacesilent, 8
bind = $mod ALT, KP_Prior, movetoworkspacesilent, 9
bind = $mod ALT, KP_Insert, movetoworkspacesilent, 10

# Move windows inside the workspace
bind = ALT, left, movewindow, l
bind = ALT, right, movewindow, r
bind = ALT, up, movewindow, u
bind = ALT, down, movewindow, d

# Session locking
bind = $mod, L, exec, hyprlock

# Update workspaces setup if laptop is opened/closed
# TODO: check if working
bind = , switch:on:Lid Switch, exec, ~/.config/hypr/scripts/monitor-setup.sh
bind = , switch:off:Lid Switch, exec, ~/.config/hypr/scripts/monitor-setup.sh

# Brightness control
bind = , XF86MonBrightnessUp,   exec, brightnessctl set 5%+
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%-

# Volume control
bind = , XF86AudioRaiseVolume,  exec, swayosd-client --output-volume raise
bind = , XF86AudioLowerVolume,  exec, swayosd-client --output-volume lower
bind = , XF86AudioMute,         exec, swayosd-client --output-volume mute-toggle

# Playback control
bind = , XF86AudioPlay,  exec, playerctl play-pause
bind = , XF86AudioStop,  exec, playerctl stop
bind = , XF86AudioNext,  exec, playerctl next
bind = , XF86AudioPrev,  exec, playerctl previous

# Show display configuration
bind = , XF86Display, exec, nwg-displays

# Toggle wifi
bind = , XF86WLAN, exec, nmcli radio wifi $(nmcli radio wifi | grep -q enabled && echo off || echo on)

# Caps lock
bind = , Caps_Lock, exec, swayosd-client --caps-lock

# Numeric pad lock
bind = , Num_Lock, exec, swayosd-client --num-lock

# Hide floating windows
#bindr = , Escape, exec, ~/.config/hypr/scripts/toggle-window.sh hide .blueman-manager-wrapped

# ────────────────────────────────────────────────────────────────────────────
# Floating configuration per application
# ────────────────────────────────────────────────────────────────────────────

# Application to configure the displays positions, etc.
windowrulev2 = float, class:nwg-displays
windowrulev2 = center, class:nwg-displays
windowrulev2 = size 50% 60%, class:nwg-displays

# Bluetooth manager
windowrulev2 = float, class:(.*blueman-manager.*)
windowrulev2 = center, class:(.*blueman-manager.*)
windowrulev2 = size 600 400, class:(.*blueman-manager.*)

# Connection editor
windowrulev2 = float, class:nm-connection-editor
windowrulev2 = center, class:nm-connection-editor
windowrulev2 = size 800 600, class:nm-connection-editor

# Audio control
windowrulev2 = float, class:(.*pwvucontrol.*)
windowrulev2 = center, class:(.*pwvucontrol.*)
windowrulev2 = size 1000 600, class:(.*pwvucontrol.*)

# Calendar
windowrulev2 = move 100%-w-5 35, class:(gsimplecal)
windowrulev2 = float, class:(gsimplecal)

# Bitwarden popup (in browser)
windowrulev2 = float, class:(.*(vivaldi|firefox).*), title:(Bitwarden.*)

# Calculator
windowrulev2 = float, class:(.*qalculate.*)
windowrulev2 = size 600 400, class:(.*qalculate.*)

# File manager
windowrulev2 = float, class:(.*thunar.*)

# File picker
windowrulev2 = float, class:xdg-desktop-portal-gtk
windowrulev2 = size 40% 50%, class:xdg-desktop-portal-gtk

# Floating terminal
windowrulev2 = float, class:floating-term
windowrulev2 = size 60% 60%, class:floating-term

# Emoji picker
windowrulev2 = float, class:it.mijorus.smile

# Steam
windowrulev2 = float, class:steam
windowrulev2 = size 50% 50%, class:floating-term
